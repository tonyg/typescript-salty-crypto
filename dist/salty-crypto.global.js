"use strict";var SaltyCrypto=(()=>{var bt=Object.defineProperty,Ae=Object.defineProperties,xe=Object.getOwnPropertyDescriptor,de=Object.getOwnPropertyDescriptors,Ue=Object.getOwnPropertyNames,ae=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var oe=(i,e,r)=>e in i?bt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[e]=r,Nt=(i,e)=>{for(var r in e||(e={}))he.call(e,r)&&oe(i,r,e[r]);if(ae)for(var r of ae(e))ge.call(e,r)&&oe(i,r,e[r]);return i},Bt=(i,e)=>Ae(i,de(e));var kt=(i=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(i,{get:(e,r)=>(typeof require!="undefined"?require:e)[r]}):i)(function(i){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});var G=(i,e)=>{for(var r in e)bt(i,r,{get:e[r],enumerable:!0})},be=(i,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ue(e))!he.call(i,n)&&n!==r&&bt(i,n,{get:()=>e[n],enumerable:!(s=xe(e,n))||s.enumerable});return i};var Ke=i=>be(bt({},"__esModule",{value:!0}),i);var Xe={};G(Xe,{AuthenticationFailure:()=>St,BLAKE2s:()=>xt,Bytes:()=>ot,ChaCha20:()=>at,ChaCha20Poly1305_RFC8439:()=>ut,CipherState:()=>rt,Handshake:()=>gt,INTERNALS:()=>Oe,IO:()=>Ht,Noise_25519_ChaChaPoly_BLAKE2s:()=>se,Nonce:()=>ct,PATTERNS:()=>dt,Poly1305:()=>pt,X25519:()=>Gt,_decrypt:()=>Ot,_encrypt:()=>Ft,_randomBytes:()=>ye,isOneWay:()=>ee,lookupPattern:()=>Ut,makeHKDF:()=>$t,makeHMAC:()=>jt,matchPattern:()=>Qt,randomBytes:()=>Xt});var Yt={};G(Yt,{ChaCha20Poly1305_RFC8439:()=>ut});var Lt={};G(Lt,{ChaCha20:()=>at,chacha20_block:()=>_t,chacha20_quarter_round:()=>it});function Kt(i,e){return i<<e|i>>>32-e}function it(i,e,r,s,n){i[e]+=i[r],i[n]^=i[e],i[n]=Kt(i[n],16),i[s]+=i[n],i[r]^=i[s],i[r]=Kt(i[r],12),i[e]+=i[r],i[n]^=i[e],i[n]=Kt(i[n],8),i[s]+=i[n],i[r]^=i[s],i[r]=Kt(i[r],7)}function fe(i,e,r,s){i[0]+=1634760805,i[1]+=857760878,i[2]+=2036477234,i[3]+=1797285236,i[4]+=e.getUint32(0,!0),i[5]+=e.getUint32(4,!0),i[6]+=e.getUint32(8,!0),i[7]+=e.getUint32(12,!0),i[8]+=e.getUint32(16,!0),i[9]+=e.getUint32(20,!0),i[10]+=e.getUint32(24,!0),i[11]+=e.getUint32(28,!0),i[12]+=r,i[13]+=s.getUint32(0,!0),i[14]+=s.getUint32(4,!0),i[15]+=s.getUint32(8,!0)}function _t(i,e,r){let s=new Uint32Array(16);fe(s,i,e,r);for(let n=0;n<20;n+=2)it(s,0,4,8,12),it(s,1,5,9,13),it(s,2,6,10,14),it(s,3,7,11,15),it(s,0,5,10,15),it(s,1,6,11,12),it(s,2,7,8,13),it(s,3,4,9,14);return fe(s,i,e,r),s}function Ee(i){let e=new DataView(new ArrayBuffer(at.NONCEBYTES));return e.setUint32(0,i.extra,!0),e.setUint32(4,i.lo,!0),e.setUint32(8,i.hi,!0),e}var at={NAME:"chacha20",KEYBYTES:32,NONCEBYTES:12,BLOCKBYTES:64,stream_xor(i,e,r,s,n=0,o=r.byteLength){let a=Ee(e),f=o>>6,c=o&63;for(let y=0;y<f;y++){let p=_t(i,n+y,a);for(let u=0;u<64;u++)s[(y<<6)+u]=r[(y<<6)+u]^p[u>>2]>>((u&3)<<3)}if(c!==0){let y=_t(i,n+f,a);for(let p=0;p<c;p++)s[(f<<6)+p]=r[(f<<6)+p]^y[p>>2]>>((p&3)<<3)}}};var Dt={};G(Dt,{Poly1305:()=>pt});var $,pt=($=class{constructor(e,r){this.buffer=new Uint8Array(16);this.r=new Uint16Array(10);this.h=new Uint16Array(10);this.pad=new Uint16Array(8);this.leftover=0;this.fin=0;if(!e)throw new Error("Poly1305: key required");if((r!=null?r:$.OUTBYTES)!==$.OUTBYTES)throw new Error("Poly1305: outlen != OUTBYTES");let s=e[0]&255|(e[1]&255)<<8;this.r[0]=s&8191;let n=e[2]&255|(e[3]&255)<<8;this.r[1]=(s>>>13|n<<3)&8191;let o=e[4]&255|(e[5]&255)<<8;this.r[2]=(n>>>10|o<<6)&7939;let a=e[6]&255|(e[7]&255)<<8;this.r[3]=(o>>>7|a<<9)&8191;let f=e[8]&255|(e[9]&255)<<8;this.r[4]=(a>>>4|f<<12)&255,this.r[5]=f>>>1&8190;let c=e[10]&255|(e[11]&255)<<8;this.r[6]=(f>>>14|c<<2)&8191;let y=e[12]&255|(e[13]&255)<<8;this.r[7]=(c>>>11|y<<5)&8065;let p=e[14]&255|(e[15]&255)<<8;this.r[8]=(y>>>8|p<<8)&8191,this.r[9]=p>>>5&127,this.pad[0]=e[16]&255|(e[17]&255)<<8,this.pad[1]=e[18]&255|(e[19]&255)<<8,this.pad[2]=e[20]&255|(e[21]&255)<<8,this.pad[3]=e[22]&255|(e[23]&255)<<8,this.pad[4]=e[24]&255|(e[25]&255)<<8,this.pad[5]=e[26]&255|(e[27]&255)<<8,this.pad[6]=e[28]&255|(e[29]&255)<<8,this.pad[7]=e[30]&255|(e[31]&255)<<8}static digest(e,r,s){let n=new $(r,s);return n.update(e),n.final()}blocks(e,r,s){let n=this.fin?0:2048,o=this.h[0],a=this.h[1],f=this.h[2],c=this.h[3],y=this.h[4],p=this.h[5],u=this.h[6],d=this.h[7],l=this.h[8],A=this.h[9],k=this.r[0],B=this.r[1],b=this.r[2],K=this.r[3],_=this.r[4],L=this.r[5],D=this.r[6],C=this.r[7],Y=this.r[8],F=this.r[9];for(;s>=16;){let q=e[r+0]&255|(e[r+1]&255)<<8;o+=q&8191;let j=e[r+2]&255|(e[r+3]&255)<<8;a+=(q>>>13|j<<3)&8191;let Q=e[r+4]&255|(e[r+5]&255)<<8;f+=(j>>>10|Q<<6)&8191;let J=e[r+6]&255|(e[r+7]&255)<<8;c+=(Q>>>7|J<<9)&8191;let tt=e[r+8]&255|(e[r+9]&255)<<8;y+=(J>>>4|tt<<12)&8191,p+=tt>>>1&8191;let nt=e[r+10]&255|(e[r+11]&255)<<8;u+=(tt>>>14|nt<<2)&8191;let ft=e[r+12]&255|(e[r+13]&255)<<8;d+=(nt>>>11|ft<<5)&8191;let yt=e[r+14]&255|(e[r+15]&255)<<8;l+=(ft>>>8|yt<<8)&8191,A+=yt>>>5|n;let m=0,U=m;U+=o*k,U+=a*(5*F),U+=f*(5*Y),U+=c*(5*C),U+=y*(5*D),m=U>>>13,U&=8191,U+=p*(5*L),U+=u*(5*_),U+=d*(5*K),U+=l*(5*b),U+=A*(5*B),m+=U>>>13,U&=8191;let g=m;g+=o*B,g+=a*k,g+=f*(5*F),g+=c*(5*Y),g+=y*(5*C),m=g>>>13,g&=8191,g+=p*(5*D),g+=u*(5*L),g+=d*(5*_),g+=l*(5*K),g+=A*(5*b),m+=g>>>13,g&=8191;let E=m;E+=o*b,E+=a*B,E+=f*k,E+=c*(5*F),E+=y*(5*Y),m=E>>>13,E&=8191,E+=p*(5*C),E+=u*(5*D),E+=d*(5*L),E+=l*(5*_),E+=A*(5*K),m+=E>>>13,E&=8191;let w=m;w+=o*K,w+=a*b,w+=f*B,w+=c*k,w+=y*(5*F),m=w>>>13,w&=8191,w+=p*(5*Y),w+=u*(5*C),w+=d*(5*D),w+=l*(5*L),w+=A*(5*_),m+=w>>>13,w&=8191;let S=m;S+=o*_,S+=a*K,S+=f*b,S+=c*B,S+=y*k,m=S>>>13,S&=8191,S+=p*(5*F),S+=u*(5*Y),S+=d*(5*C),S+=l*(5*D),S+=A*(5*L),m+=S>>>13,S&=8191;let M=m;M+=o*L,M+=a*_,M+=f*K,M+=c*b,M+=y*B,m=M>>>13,M&=8191,M+=p*k,M+=u*(5*F),M+=d*(5*Y),M+=l*(5*C),M+=A*(5*D),m+=M>>>13,M&=8191;let T=m;T+=o*D,T+=a*L,T+=f*_,T+=c*K,T+=y*b,m=T>>>13,T&=8191,T+=p*B,T+=u*k,T+=d*(5*F),T+=l*(5*Y),T+=A*(5*C),m+=T>>>13,T&=8191;let P=m;P+=o*C,P+=a*D,P+=f*L,P+=c*_,P+=y*K,m=P>>>13,P&=8191,P+=p*b,P+=u*B,P+=d*k,P+=l*(5*F),P+=A*(5*Y),m+=P>>>13,P&=8191;let H=m;H+=o*Y,H+=a*C,H+=f*D,H+=c*L,H+=y*_,m=H>>>13,H&=8191,H+=p*K,H+=u*b,H+=d*B,H+=l*k,H+=A*(5*F),m+=H>>>13,H&=8191;let N=m;N+=o*F,N+=a*Y,N+=f*C,N+=c*D,N+=y*L,m=N>>>13,N&=8191,N+=p*_,N+=u*K,N+=d*b,N+=l*B,N+=A*k,m+=N>>>13,N&=8191,m=(m<<2)+m|0,m=m+U|0,U=m&8191,m=m>>>13,g+=m,o=U,a=g,f=E,c=w,y=S,p=M,u=T,d=P,l=H,A=N,r+=16,s-=16}this.h[0]=o,this.h[1]=a,this.h[2]=f,this.h[3]=c,this.h[4]=y,this.h[5]=p,this.h[6]=u,this.h[7]=d,this.h[8]=l,this.h[9]=A}final(e){if(e||(e=new Uint8Array($.OUTBYTES)),this.leftover){let a=this.leftover;for(this.buffer[a++]=1;a<16;a++)this.buffer[a]=0;this.fin=1,this.blocks(this.buffer,0,16)}let r=this.h[1]>>>13;this.h[1]&=8191;for(let a=2;a<10;a++)this.h[a]+=r,r=this.h[a]>>>13,this.h[a]&=8191;this.h[0]+=r*5,r=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=r,r=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=r;let s=new Uint16Array(10);s[0]=this.h[0]+5,r=s[0]>>>13,s[0]&=8191;for(let a=1;a<10;a++)s[a]=this.h[a]+r,r=s[a]>>>13,s[a]&=8191;s[9]-=8192;let n=(r^1)-1;for(let a=0;a<10;a++)s[a]&=n;n=~n;for(let a=0;a<10;a++)this.h[a]=this.h[a]&n|s[a];this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535;let o=this.h[0]+this.pad[0];this.h[0]=o&65535;for(let a=1;a<8;a++)o=(this.h[a]+this.pad[a]|0)+(o>>>16)|0,this.h[a]=o&65535;return e[0]=this.h[0]>>>0&255,e[1]=this.h[0]>>>8&255,e[2]=this.h[1]>>>0&255,e[3]=this.h[1]>>>8&255,e[4]=this.h[2]>>>0&255,e[5]=this.h[2]>>>8&255,e[6]=this.h[3]>>>0&255,e[7]=this.h[3]>>>8&255,e[8]=this.h[4]>>>0&255,e[9]=this.h[4]>>>8&255,e[10]=this.h[5]>>>0&255,e[11]=this.h[5]>>>8&255,e[12]=this.h[6]>>>0&255,e[13]=this.h[6]>>>8&255,e[14]=this.h[7]>>>0&255,e[15]=this.h[7]>>>8&255,e}update(e,r=0,s=e.byteLength){if(this.leftover){let n=16-this.leftover;n>s&&(n=s);for(let o=0;o<n;o++)this.buffer[this.leftover+o]=e[r+o];if(s-=n,r+=n,this.leftover+=n,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(s>=16){let n=s-s%16;this.blocks(e,r,n),r+=n,s-=n}if(s){for(let n=0;n<s;n++)this.buffer[this.leftover+n]=e[r+n];this.leftover+=s}}},$.NAME="Poly1305",$.KEYBYTES=32,$.OUTBYTES=16,$.BLOCKLEN=16,$);var ot={};G(ot,{EMPTY:()=>wt,append:()=>W,equal:()=>Ct,xor:()=>Et});function we(i,e,r){let s=0;for(let n=0;n<r;n++)s|=i[n]^e[n];return(1&s-1>>>8)-1}function Ct(i,e,r){return we(i,e,r)===0}function Et(i,e){let r=Math.min(i.byteLength,e.byteLength),s=new Uint8Array(r);for(let n=0;n<r;n++)s[n]=i[n]^e[n];return s}function W(i,e){let r=new Uint8Array(i.byteLength+e.byteLength);return r.set(i,0),r.set(e,i.byteLength),r}var wt=new Uint8Array(0);var Se=new Uint8Array(16);function le(i,e){let r=e&15;r!==0&&i.update(Se,0,16-r)}function ce(i,e,r,s,n,o){let a=new Uint8Array(pt.KEYBYTES);at.stream_xor(e,r,a,a,0);let f=new pt(a);o!==void 0&&(f.update(o,0,o.byteLength),le(f,o.byteLength)),f.update(s,0,n),le(f,n);let c=new Uint8Array(16),y=new DataView(c.buffer);o!==void 0&&y.setUint32(0,o.byteLength,!0),y.setUint32(8,n,!0),f.update(c,0,c.byteLength),f.final(i)}var ut={NAME:"ChaChaPoly",KEYBYTES:32,NONCEBYTES:12,TAGBYTES:16,encrypt_detached(i,e,r,s,n,o,a){at.stream_xor(n,o,i,e,1,r),ce(s,n,o,e,r,a)},encrypt:Ft,decrypt_detached(i,e,r,s,n,o,a){let f=new Uint8Array(this.TAGBYTES);ce(f,n,o,e,r,a);let c=Ct(f,s,f.byteLength);return c&&at.stream_xor(n,o,e,i,1,r),c},decrypt:Ot};var St=class extends Error{};function Ft(i,e,r,s){let n=new Uint8Array(i.byteLength+this.TAGBYTES);return this.encrypt_detached(i,n,i.byteLength,n.subarray(i.byteLength),e,r,s),n}function Ot(i,e,r,s){let n=new Uint8Array(i.byteLength-this.TAGBYTES);if(!this.decrypt_detached(n,i,n.byteLength,i.subarray(n.byteLength),e,r,s))throw new St("AEAD authentication failed");return n}var ye=(()=>{if(crypto&&crypto.getRandomValues)return(e,r)=>{for(let s=0;s<r;s+=65536)crypto.getRandomValues(e.subarray(s,s+Math.min(r-s,65536)))};if(typeof kt!="undefined"){let i=kt("crypto");if(i&&i.randomBytes)return(e,r)=>e.set(i.randomBytes(r))}throw new Error("No usable randomness source found")})();function Xt(i){let e=new Uint8Array(i);return ye(e,i),e}var zt={};G(zt,{crypto_scalarmult:()=>Vt,crypto_scalarmult_BYTES:()=>Me,crypto_scalarmult_SCALARBYTES:()=>Te,crypto_scalarmult_base:()=>ue,scalarMult:()=>lt,scalarMultBase:()=>vt});var Me=32,Te=32;function et(){return new Float64Array(16)}var pe=new Uint8Array(32);pe[0]=9;var Rt=et();Rt[0]=56129;Rt[1]=1;function It(i){let e=1;for(let r=0;r<16;r++){let s=i[r]+e+65535;e=Math.floor(s/65536),i[r]=s-e*65536}i[0]+=e-1+37*(e-1)}function mt(i,e,r){let s=~(r-1);for(let n=0;n<16;n++){let o=s&(i[n]^e[n]);i[n]^=o,e[n]^=o}}function Pe(i,e){let r=et(),s=et();for(let n=0;n<16;n++)s[n]=e[n];It(s),It(s),It(s);for(let n=0;n<2;n++){r[0]=s[0]-65517;for(let a=1;a<15;a++)r[a]=s[a]-65535-(r[a-1]>>16&1),r[a-1]&=65535;r[15]=s[15]-32767-(r[14]>>16&1);let o=r[15]>>16&1;r[14]&=65535,mt(s,r,1-o)}for(let n=0;n<16;n++)i[2*n]=s[n]&255,i[2*n+1]=s[n]>>8}function He(i,e){for(let r=0;r<16;r++)i[r]=e[2*r]+(e[2*r+1]<<8);i[15]&=32767}function Mt(i,e,r){for(let s=0;s<16;s++)i[s]=e[s]+r[s]}function Tt(i,e,r){for(let s=0;s<16;s++)i[s]=e[s]-r[s]}function st(i,e,r){let s=0,n=0,o=0,a=0,f=0,c=0,y=0,p=0,u=0,d=0,l=0,A=0,k=0,B=0,b=0,K=0,_=0,L=0,D=0,C=0,Y=0,F=0,q=0,j=0,Q=0,J=0,tt=0,nt=0,ft=0,yt=0,m=0,U=r[0],g=r[1],E=r[2],w=r[3],S=r[4],M=r[5],T=r[6],P=r[7],H=r[8],N=r[9],O=r[10],X=r[11],I=r[12],R=r[13],V=r[14],v=r[15],t=e[0];s+=t*U,n+=t*g,o+=t*E,a+=t*w,f+=t*S,c+=t*M,y+=t*T,p+=t*P,u+=t*H,d+=t*N,l+=t*O,A+=t*X,k+=t*I,B+=t*R,b+=t*V,K+=t*v,t=e[1],n+=t*U,o+=t*g,a+=t*E,f+=t*w,c+=t*S,y+=t*M,p+=t*T,u+=t*P,d+=t*H,l+=t*N,A+=t*O,k+=t*X,B+=t*I,b+=t*R,K+=t*V,_+=t*v,t=e[2],o+=t*U,a+=t*g,f+=t*E,c+=t*w,y+=t*S,p+=t*M,u+=t*T,d+=t*P,l+=t*H,A+=t*N,k+=t*O,B+=t*X,b+=t*I,K+=t*R,_+=t*V,L+=t*v,t=e[3],a+=t*U,f+=t*g,c+=t*E,y+=t*w,p+=t*S,u+=t*M,d+=t*T,l+=t*P,A+=t*H,k+=t*N,B+=t*O,b+=t*X,K+=t*I,_+=t*R,L+=t*V,D+=t*v,t=e[4],f+=t*U,c+=t*g,y+=t*E,p+=t*w,u+=t*S,d+=t*M,l+=t*T,A+=t*P,k+=t*H,B+=t*N,b+=t*O,K+=t*X,_+=t*I,L+=t*R,D+=t*V,C+=t*v,t=e[5],c+=t*U,y+=t*g,p+=t*E,u+=t*w,d+=t*S,l+=t*M,A+=t*T,k+=t*P,B+=t*H,b+=t*N,K+=t*O,_+=t*X,L+=t*I,D+=t*R,C+=t*V,Y+=t*v,t=e[6],y+=t*U,p+=t*g,u+=t*E,d+=t*w,l+=t*S,A+=t*M,k+=t*T,B+=t*P,b+=t*H,K+=t*N,_+=t*O,L+=t*X,D+=t*I,C+=t*R,Y+=t*V,F+=t*v,t=e[7],p+=t*U,u+=t*g,d+=t*E,l+=t*w,A+=t*S,k+=t*M,B+=t*T,b+=t*P,K+=t*H,_+=t*N,L+=t*O,D+=t*X,C+=t*I,Y+=t*R,F+=t*V,q+=t*v,t=e[8],u+=t*U,d+=t*g,l+=t*E,A+=t*w,k+=t*S,B+=t*M,b+=t*T,K+=t*P,_+=t*H,L+=t*N,D+=t*O,C+=t*X,Y+=t*I,F+=t*R,q+=t*V,j+=t*v,t=e[9],d+=t*U,l+=t*g,A+=t*E,k+=t*w,B+=t*S,b+=t*M,K+=t*T,_+=t*P,L+=t*H,D+=t*N,C+=t*O,Y+=t*X,F+=t*I,q+=t*R,j+=t*V,Q+=t*v,t=e[10],l+=t*U,A+=t*g,k+=t*E,B+=t*w,b+=t*S,K+=t*M,_+=t*T,L+=t*P,D+=t*H,C+=t*N,Y+=t*O,F+=t*X,q+=t*I,j+=t*R,Q+=t*V,J+=t*v,t=e[11],A+=t*U,k+=t*g,B+=t*E,b+=t*w,K+=t*S,_+=t*M,L+=t*T,D+=t*P,C+=t*H,Y+=t*N,F+=t*O,q+=t*X,j+=t*I,Q+=t*R,J+=t*V,tt+=t*v,t=e[12],k+=t*U,B+=t*g,b+=t*E,K+=t*w,_+=t*S,L+=t*M,D+=t*T,C+=t*P,Y+=t*H,F+=t*N,q+=t*O,j+=t*X,Q+=t*I,J+=t*R,tt+=t*V,nt+=t*v,t=e[13],B+=t*U,b+=t*g,K+=t*E,_+=t*w,L+=t*S,D+=t*M,C+=t*T,Y+=t*P,F+=t*H,q+=t*N,j+=t*O,Q+=t*X,J+=t*I,tt+=t*R,nt+=t*V,ft+=t*v,t=e[14],b+=t*U,K+=t*g,_+=t*E,L+=t*w,D+=t*S,C+=t*M,Y+=t*T,F+=t*P,q+=t*H,j+=t*N,Q+=t*O,J+=t*X,tt+=t*I,nt+=t*R,ft+=t*V,yt+=t*v,t=e[15],K+=t*U,_+=t*g,L+=t*E,D+=t*w,C+=t*S,Y+=t*M,F+=t*T,q+=t*P,j+=t*H,Q+=t*N,J+=t*O,tt+=t*X,nt+=t*I,ft+=t*R,yt+=t*V,m+=t*v,s+=38*_,n+=38*L,o+=38*D,a+=38*C,f+=38*Y,c+=38*F,y+=38*q,p+=38*j,u+=38*Q,d+=38*J,l+=38*tt,A+=38*nt,k+=38*ft,B+=38*yt,b+=38*m;let h=1;t=s+h+65535,h=Math.floor(t/65536),s=t-h*65536,t=n+h+65535,h=Math.floor(t/65536),n=t-h*65536,t=o+h+65535,h=Math.floor(t/65536),o=t-h*65536,t=a+h+65535,h=Math.floor(t/65536),a=t-h*65536,t=f+h+65535,h=Math.floor(t/65536),f=t-h*65536,t=c+h+65535,h=Math.floor(t/65536),c=t-h*65536,t=y+h+65535,h=Math.floor(t/65536),y=t-h*65536,t=p+h+65535,h=Math.floor(t/65536),p=t-h*65536,t=u+h+65535,h=Math.floor(t/65536),u=t-h*65536,t=d+h+65535,h=Math.floor(t/65536),d=t-h*65536,t=l+h+65535,h=Math.floor(t/65536),l=t-h*65536,t=A+h+65535,h=Math.floor(t/65536),A=t-h*65536,t=k+h+65535,h=Math.floor(t/65536),k=t-h*65536,t=B+h+65535,h=Math.floor(t/65536),B=t-h*65536,t=b+h+65535,h=Math.floor(t/65536),b=t-h*65536,t=K+h+65535,h=Math.floor(t/65536),K=t-h*65536,s+=h-1+37*(h-1),h=1,t=s+h+65535,h=Math.floor(t/65536),s=t-h*65536,t=n+h+65535,h=Math.floor(t/65536),n=t-h*65536,t=o+h+65535,h=Math.floor(t/65536),o=t-h*65536,t=a+h+65535,h=Math.floor(t/65536),a=t-h*65536,t=f+h+65535,h=Math.floor(t/65536),f=t-h*65536,t=c+h+65535,h=Math.floor(t/65536),c=t-h*65536,t=y+h+65535,h=Math.floor(t/65536),y=t-h*65536,t=p+h+65535,h=Math.floor(t/65536),p=t-h*65536,t=u+h+65535,h=Math.floor(t/65536),u=t-h*65536,t=d+h+65535,h=Math.floor(t/65536),d=t-h*65536,t=l+h+65535,h=Math.floor(t/65536),l=t-h*65536,t=A+h+65535,h=Math.floor(t/65536),A=t-h*65536,t=k+h+65535,h=Math.floor(t/65536),k=t-h*65536,t=B+h+65535,h=Math.floor(t/65536),B=t-h*65536,t=b+h+65535,h=Math.floor(t/65536),b=t-h*65536,t=K+h+65535,h=Math.floor(t/65536),K=t-h*65536,s+=h-1+37*(h-1),i[0]=s,i[1]=n,i[2]=o,i[3]=a,i[4]=f,i[5]=c,i[6]=y,i[7]=p,i[8]=u,i[9]=d,i[10]=l,i[11]=A,i[12]=k,i[13]=B,i[14]=b,i[15]=K}function At(i,e){st(i,e,e)}function Ne(i,e){let r=et();for(let s=0;s<16;s++)r[s]=e[s];for(let s=253;s>=0;s--)At(r,r),s!==2&&s!==4&&st(r,r,e);for(let s=0;s<16;s++)i[s]=r[s]}function Vt(i,e,r){let s=new Uint8Array(32),n=new Float64Array(80),o=et(),a=et(),f=et(),c=et(),y=et(),p=et();for(let l=0;l<31;l++)s[l]=e[l];s[31]=e[31]&127|64,s[0]&=248,He(n,r);for(let l=0;l<16;l++)a[l]=n[l],c[l]=o[l]=f[l]=0;o[0]=c[0]=1;for(let l=254;l>=0;--l){let A=s[l>>>3]>>>(l&7)&1;mt(o,a,A),mt(f,c,A),Mt(y,o,f),Tt(o,o,f),Mt(f,a,c),Tt(a,a,c),At(c,y),At(p,o),st(o,f,o),st(f,a,y),Mt(y,o,f),Tt(o,o,f),At(a,o),Tt(f,c,p),st(o,f,Rt),Mt(o,o,c),st(f,f,o),st(o,c,p),st(c,a,n),At(a,y),mt(o,a,A),mt(f,c,A)}for(let l=0;l<16;l++)n[l+16]=o[l],n[l+32]=f[l],n[l+48]=a[l],n[l+64]=c[l];let u=n.subarray(32),d=n.subarray(16);Ne(u,u),st(d,d,u),Pe(i,d)}function ue(i,e){Vt(i,e,pe)}function lt(i,e){if(i.length!==32)throw new Error("bad n size");if(e.length!==32)throw new Error("bad p size");let r=new Uint8Array(32);return Vt(r,i,e),r}function vt(i){if(i.length!==32)throw new Error("bad n size");let e=new Uint8Array(32);return ue(e,i),e}lt.scalarLength=32;lt.groupElementLength=32;var Gt={NAME:"25519",DHLEN:lt.groupElementLength,generateKeypair(){let i=Xt(lt.scalarLength);return{public:vt(i),secret:i}},dh(i,e){return lt(i.secret,e)}};var qt={};G(qt,{BLAKE2s:()=>xt});function Pt(i,e){return i>>>e|i<<32-e}function ht(i,e,r,s,n,o,a){i[e]=i[e]+i[r]+o,i[n]=Pt(i[n]^i[e],16),i[s]=i[s]+i[n],i[r]=Pt(i[r]^i[s],12),i[e]=i[e]+i[r]+a,i[n]=Pt(i[n]^i[e],8),i[s]=i[s]+i[n],i[r]=Pt(i[r]^i[s],7)}var me=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Be=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]);function z(i,e){return Be[(i<<4)+e]}var Z,xt=(Z=class{constructor(e,r=Z.OUTBYTES){this.outlen=r;this.b=new Uint8Array(64);this.bv=new DataView(this.b.buffer);this.h=Uint32Array.from(me);this.t=new Uint32Array(2);this.c=0;var n;let s=(n=e==null?void 0:e.byteLength)!=null?n:0;if(r==0||r>32||s>32)throw new Error("illegal BLAKE2s parameter length(s)");this.h[0]^=16842752^s<<8^r,e&&s>0&&(this.update(e),this.c=64)}static digest(e,r,s){let n=new Z(r,s);return n.update(e),n.final()}update(e,r=0,s=e.byteLength){for(let n=r;n<r+s;n++)this.c==64&&(this.t[0]+=this.c,this.t[0]<this.c&&this.t[1]++,this.compress(!1),this.c=0),this.b[this.c++]=e[n]}final(e){for(this.t[0]+=this.c,this.t[0]<this.c&&this.t[1]++;this.c<64;)this.b[this.c++]=0;this.compress(!0),e===void 0&&(e=new Uint8Array(this.outlen));for(let r=0;r<this.outlen;r++)e[r]=this.h[r>>2]>>8*(r&3)&255;return e}compress(e){let r=new Uint32Array(16),s=new Uint32Array(16);for(let n=0;n<8;n++)r[n]=this.h[n],r[n+8]=me[n];r[12]^=this.t[0],r[13]^=this.t[1],e&&(r[14]=~r[14]);for(let n=0;n<16;n++)s[n]=this.bv.getUint32(n<<2,!0);for(let n=0;n<10;n++)ht(r,0,4,8,12,s[z(n,0)],s[z(n,1)]),ht(r,1,5,9,13,s[z(n,2)],s[z(n,3)]),ht(r,2,6,10,14,s[z(n,4)],s[z(n,5)]),ht(r,3,7,11,15,s[z(n,6)],s[z(n,7)]),ht(r,0,5,10,15,s[z(n,8)],s[z(n,9)]),ht(r,1,6,11,12,s[z(n,10)],s[z(n,11)]),ht(r,2,7,8,13,s[z(n,12)],s[z(n,13)]),ht(r,3,4,9,14,s[z(n,14)],s[z(n,15)]);for(let n=0;n<8;n++)this.h[n]^=r[n]^r[n+8]}},Z.NAME="BLAKE2s",Z.KEYBYTES=32,Z.OUTBYTES=32,Z.BLOCKLEN=64,Z);function $t(i){function e(r,s,n){let o=i(r,s),a=i(o,Uint8Array.from([1])),f=i(o,W(a,Uint8Array.from([2])));switch(n){case 2:return[a,f];case 3:return[a,f,i(o,W(f,Uint8Array.from([3])))]}}return e}function jt(i){let e=new Uint8Array(i.BLOCKLEN);e.fill(54);let r=new Uint8Array(i.BLOCKLEN);r.fill(92);let s=(n,o)=>{let a=n.byteLength>i.BLOCKLEN?i.digest(n):n,f=W(a,new Uint8Array(i.BLOCKLEN-a.byteLength));return i.digest(W(Et(f,r),i.digest(W(Et(f,e),o))))};return s.NAME="HMAC-"+i.NAME,s}var Ht={};G(Ht,{fromBase64:()=>De,fromHex:()=>_e,toBase64:()=>Le,toHex:()=>ke});function ke(i){let e="";return i.forEach(r=>{e=e+"0123456789abcdef"[r>>4],e=e+"0123456789abcdef"[r&15]}),e}function _e(i){if(i=i.replace(/[^0-9a-fA-F]/g,"").toLowerCase(),i.length%2)throw new Error("Hex input contains an odd number of digits");let e=Math.floor(i.length/2),r=new Uint8Array(e);for(let s=0;s<e;s++)r[s]=parseInt(i.substring(2*s,2*s+2),16);return r}function Le(i,e=!0){let r="";i.forEach(n=>r=r+String.fromCharCode(n));let s=btoa(r);return e||(s=s.replace(/=/g,"")),s}function De(i){let e=atob(i),r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r}var Wt={};G(Wt,{matchPattern:()=>Qt});function Qt(i,e){let s=new RegExp(`^Noise_([A-Za-z0-9+]+)_${i.dh.NAME}_${i.aead.NAME}_${i.hash.NAME}$`).exec(e);return s===null?null:s[1]}var te={};G(te,{CipherState:()=>rt});var ct=class i{constructor(e=0,r=0,s=0){this.lo=e;this.hi=r;this.extra=s}increment(){let e=this.lo,r=e+1|0;this.lo=r,r<e&&(this.hi=this.hi+1|0)}reset(e=0,r=0,s=0){this.lo=e,this.hi=r,this.extra=s}static get MAX(){return new i(4294967295,4294967295)}};var Jt={};G(Jt,{makeRekey:()=>Zt});function Zt(i){return e=>new DataView(i.encrypt(new Uint8Array(32),e,ct.MAX).buffer)}var rt=class{constructor(e,r){this.algorithms=e;this.view=null;this.nonce=new ct;r!==void 0&&(this.view=new DataView(r.buffer)),this.maxPayload=65535-this.algorithms.aead.TAGBYTES}encrypt(e,r){if(this.view===null)return e;let s=this.algorithms.aead.encrypt(e,this.view,this.nonce,r);return this.nonce.increment(),s}decrypt(e,r){if(this.view===null)return e;let s=this.algorithms.aead.decrypt(e,this.view,this.nonce,r);return this.nonce.increment(),s}rekey(){var e;this.view!==null&&(this.view=((e=this.algorithms.rekey)!=null?e:Zt(this.algorithms.aead))(this.view))}encrypt_large(e){if(e.byteLength>this.maxPayload){let r=[];for(;e.byteLength>this.maxPayload;)r.push(this.encrypt(e.subarray(0,this.maxPayload))),e=e.subarray(this.maxPayload);return e.byteLength>0&&r.push(this.encrypt(e)),r}else return[this.encrypt(e)]}decrypt_large(e){let r=e.reduce((o,a)=>o+a.byteLength-this.algorithms.aead.TAGBYTES,0),s=new Uint8Array(r),n=0;return e.forEach(o=>{let a=this.decrypt(o);s.set(a,n),n+=a.byteLength}),s}};var ie={};G(ie,{Handshake:()=>gt});var re={};G(re,{PATTERNS:()=>dt,isOneWay:()=>ee,lookupPattern:()=>Ut});var dt={};function x(i,e,r,s){let n={name:i,baseName:i,messages:e,initiatorPreMessage:r,responderPreMessage:s};dt[n.name]=n}x("I1K1",[["e","s"],["e","ee","es"],["se"]],[],["s"]);x("I1K",[["e","es","s"],["e","ee"],["se"]],[],["s"]);x("I1N",[["e","s"],["e","ee"],["se"]],[],[]);x("I1X1",[["e","s"],["e","ee","s"],["se","es"]],[],[]);x("I1X",[["e","s"],["e","ee","s","es"],["se"]],[],[]);x("IK1",[["e","s"],["e","ee","se","es"]],[],["s"]);x("IK",[["e","es","s","ss"],["e","ee","se"]],[],["s"]);x("IN",[["e","s"],["e","ee","se"]],[],[]);x("IX1",[["e","s"],["e","ee","se","s"],["es"]],[],[]);x("IX",[["e","s"],["e","ee","se","s","es"]],[],[]);x("K1K1",[["e"],["e","ee","es"],["se"]],["s"],["s"]);x("K1K",[["e","es"],["e","ee"],["se"]],["s"],["s"]);x("K1N",[["e"],["e","ee"],["se"]],["s"],[]);x("K1X1",[["e"],["e","ee","s"],["se","es"]],["s"],[]);x("K1X",[["e"],["e","ee","s","es"],["se"]],["s"],[]);x("K",[["e","es","ss"]],["s"],["s"]);x("KK1",[["e"],["e","ee","se","es"]],["s"],["s"]);x("KK",[["e","es","ss"],["e","ee","se"]],["s"],["s"]);x("KN",[["e"],["e","ee","se"]],["s"],[]);x("KX1",[["e"],["e","ee","se","s"],["es"]],["s"],[]);x("KX",[["e"],["e","ee","se","s","es"]],["s"],[]);x("N",[["e","es"]],[],["s"]);x("NK1",[["e"],["e","ee","es"]],[],["s"]);x("NK",[["e","es"],["e","ee"]],[],["s"]);x("NN",[["e"],["e","ee"]],[],[]);x("NX1",[["e"],["e","ee","s"],["es"]],[],[]);x("NX",[["e"],["e","ee","s","es"]],[],[]);x("X1K1",[["e"],["e","ee","es"],["s"],["se"]],[],["s"]);x("X1K",[["e","es"],["e","ee"],["s"],["se"]],[],["s"]);x("X1N",[["e"],["e","ee"],["s"],["se"]],[],[]);x("X1X1",[["e"],["e","ee","s"],["es","s"],["se"]],[],[]);x("X1X",[["e"],["e","ee","s","es"],["s"],["se"]],[],[]);x("X",[["e","es","s","ss"]],[],["s"]);x("XK1",[["e"],["e","ee","es"],["s","se"]],[],["s"]);x("XK",[["e","es"],["e","ee"],["s","se"]],[],["s"]);x("XN",[["e"],["e","ee"],["s","se"]],[],[]);x("XX1",[["e"],["e","ee","s"],["es","s","se"]],[],[]);x("XX",[["e"],["e","ee","s","es"],["s","se"]],[],[]);function ee(i){return i.baseName.length===1}var Ce=/^([NKX]|[NKXI]1?[NKX]1?)([a-z][a-z0-9]*(\+[a-z][a-z0-9]*)*)?$/,Ye=/^psk([0-9]+)$/;function Ut(i){var n,o,a;let e=Ce.exec(i);if(e===null)return null;let r=(o=(n=e[2])==null?void 0:n.split("+"))!=null?o:[],s=(a=dt[e[1]])!=null?a:null;return s?(r.forEach(f=>s=s&&Fe(s,f)),s&&Bt(Nt({},s),{name:i})):null}function Fe(i,e){let r=Ye.exec(e);if(r===null)return null;let s=parseInt(r[1],10),n=i.messages;return Bt(Nt({},i),{messages:s===0?[["psk",...n[0]],...n.slice(1)]:[...n.slice(0,s-1),[...n[s-1],"psk"],...n.slice(s)]})}var gt=class{constructor(e,r,s,n={}){this.algorithms=e;this.role=s;this.stepIndex=0;var a,f,c,y,p,u,d;if(typeof r=="string"){let l=Ut(r);if(l===null)throw new Error("Unknown Noise Protocol handshake pattern "+r);this.pattern=l}else this.pattern=r;this.staticKeypair=(a=n.staticKeypair)!=null?a:this.algorithms.dh.generateKeypair(),this.remoteStaticPublicKey=(f=n.remoteStaticPublicKey)!=null?f:null,this.ephemeralKeypair=(c=n.pregeneratedEphemeralKeypair)!=null?c:this.algorithms.dh.generateKeypair(),this.remoteEphemeralPublicKey=(y=n.remotePregeneratedEphemeralPublicKey)!=null?y:null,this.preSharedKeys=n.preSharedKeys,this.preSharedKeys&&(this.preSharedKeys=this.preSharedKeys.slice(),this.preSharedKeys.length===0&&(this.preSharedKeys=void 0));let o=new TextEncoder().encode("Noise_"+this.pattern.name+"_"+this.algorithms.dh.NAME+"_"+this.algorithms.aead.NAME+"_"+this.algorithms.hash.NAME);this.cipherState=new rt(this.algorithms);{let l=this.algorithms.hash.OUTBYTES,A=o.byteLength>l?this.algorithms.hash.digest(o):o;this.chainingKey=W(A,new Uint8Array(l-A.byteLength))}this.handshakeHash=this.chainingKey,this.mixHash((p=n.prologue)!=null?p:wt),this.pattern.initiatorPreMessage.forEach(l=>this.mixHash(l==="e"?this.isInitiator?this.ephemeralKeypair.public:this.remoteEphemeralPublicKey:this.isInitiator?this.staticKeypair.public:this.remoteStaticPublicKey)),this.pattern.responderPreMessage.forEach(l=>this.mixHash(l==="e"?this.isInitiator?this.remoteEphemeralPublicKey:this.ephemeralKeypair.public:this.isInitiator?this.remoteStaticPublicKey:this.staticKeypair.public)),this.hkdf=(d=this.algorithms.hkdf)!=null?d:$t((u=this.algorithms.hmac)!=null?u:jt(this.algorithms.hash))}get isInitiator(){return this.role==="initiator"}mixHash(e){this.handshakeHash=this.algorithms.hash.digest(W(this.handshakeHash,e))}mixKey(e){let[r,s]=this.hkdf(this.chainingKey,e,2);this.chainingKey=r,this.cipherState=new rt(this.algorithms,s)}mixKeyAndHashNextPSK(){let e=this.preSharedKeys.shift(),[r,s,n]=this.hkdf(this.chainingKey,e,3);this.chainingKey=r,this.mixHash(s),this.cipherState=new rt(this.algorithms,n)}encryptAndHash(e){let r=this.cipherState.encrypt(e,this.handshakeHash);return this.mixHash(r),r}decryptAndHash(e){let r=this.cipherState.decrypt(e,this.handshakeHash);return this.mixHash(e),r}_split(){if(this.stepIndex<this.pattern.messages.length)return null;{let[e,r]=this.hkdf(this.chainingKey,wt,2).map(s=>new rt(this.algorithms,s));return this.isInitiator?{send:e,recv:r}:{send:r,recv:e}}}_nextStep(){if(this.stepIndex>=this.pattern.messages.length)throw new Error("Handshake already complete, cannot continue");return this.pattern.messages[this.stepIndex++]}_processKeyMixToken(e){switch(e){case"ee":this.mixKey(this.algorithms.dh.dh(this.ephemeralKeypair,this.remoteEphemeralPublicKey));break;case"es":this.mixKey(this.isInitiator?this.algorithms.dh.dh(this.ephemeralKeypair,this.remoteStaticPublicKey):this.algorithms.dh.dh(this.staticKeypair,this.remoteEphemeralPublicKey));break;case"se":this.mixKey(this.isInitiator?this.algorithms.dh.dh(this.staticKeypair,this.remoteEphemeralPublicKey):this.algorithms.dh.dh(this.ephemeralKeypair,this.remoteStaticPublicKey));break;case"ss":this.mixKey(this.algorithms.dh.dh(this.staticKeypair,this.remoteStaticPublicKey));break;case"psk":this.mixKeyAndHashNextPSK();break}}writeMessage(e){let r=[];this._nextStep().forEach(n=>{switch(n){case"e":r.push(this.ephemeralKeypair.public),this.mixHash(this.ephemeralKeypair.public),this.preSharedKeys&&this.mixKey(this.ephemeralKeypair.public);break;case"s":r.push(this.encryptAndHash(this.staticKeypair.public));break;default:this._processKeyMixToken(n);break}}),r.push(this.encryptAndHash(e));let s;if(r.length===1)s=r[0];else{s=new Uint8Array(r.reduce((o,a)=>o+a.byteLength,0));let n=0;r.forEach(o=>{s.set(o,n),n+=o.byteLength})}return{packet:s,finished:this._split()}}readMessage(e){let r=n=>{let o=e.slice(0,n);return e=e.subarray(n),o};return this._nextStep().forEach(n=>{switch(n){case"e":this.remoteEphemeralPublicKey=r(this.algorithms.dh.DHLEN),this.mixHash(this.remoteEphemeralPublicKey),this.preSharedKeys&&this.mixKey(this.remoteEphemeralPublicKey);break;case"s":this.remoteStaticPublicKey=this.decryptAndHash(r(this.algorithms.dh.DHLEN+(this.cipherState.view?16:0)));break;default:this._processKeyMixToken(n);break}}),{message:this.decryptAndHash(e),finished:this._split()}}async completeHandshake(e,r,s=async o=>{},n=async()=>new Uint8Array(0)){let o=async()=>{let{packet:f,finished:c}=this.writeMessage(await n());return await e(f),c||a()},a=async()=>{let{message:f,finished:c}=this.readMessage(await r());return await s(f),c||o()};return this.isInitiator?o():a()}};var ne={};G(ne,{Noise_25519_ChaChaPoly_BLAKE2s:()=>se});var se={dh:Gt,aead:ut,hash:xt};var Oe={aead:{chacha20poly1305:Yt},cipher:{chacha20:Lt},dh:{x25519:zt},hash:{blake2s:qt,poly1305:Dt},noise:{algorithms:Wt,cipherstate:te,handshake:ie,patterns:re,profiles:ne,rekey:Jt}};return Ke(Xe);})();
//# sourceMappingURL=salty-crypto.global.js.map